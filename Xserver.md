# xserver调试（Xorg）

## 方法一

1. `apt source     xserver-xorg-core`
2. `sudo apt build-dep     xserver-xorg-core`
3. dpkg-buildflags 查看编译的flags, 将O2换成O0
	* note: -fdebug-prefix-map= path **该参数可以不需要**

`DEB_CFLAGS_SET="-ggdb3 -O0 -fdebug-prefix-map=/home/pathxxxxxx/xserver-xorg=. -fstack-protector-strong -Wformat -Werror=format-security" DEB_CXXFLAGS_SET="-ggdb3 -O0 -fdebug-prefix-map=/home/pathxxxxxx/xserver-xorg=. -fstack-protector-strong -Wformat -Werror=format-security" dpkg-buildpackage -uc -b`

​	4.第二次有改动时，使用

`DEB_CFLAGS_SET="-ggdb3 -O0 -fdebug-prefix-map=/home/pathxxxxxx/xserver-xorg=. -fstack-protector-strong -Wformat -Werror=format-security" DEB_CXXFLAGS_SET="-ggdb3 -O0 -fdebug-prefix-map=/home/pathxxxxxx/xserver-xorg=. -fstack-protector-strong -Wformat -Werror=format-security"  dpkg-buildpackage -uc -nc -b`

## 方法二

we can override build flags generated by dpkg-buildflags, one way is create /etc/dpkg/buildflags.conf,

add command like this:

``` bash
CFLAGS  -ggdb3 -O0 -fstack-protector-strong -Wformat -Werror=format-security

OBJCFLAGS  -ggdb3 -O0 -fstack-protector-strong -Wformat -Werror=format-security
```

we can run command `dpkg-buildflags` to get original build flags, and only modify ` CFLAGS/OBJCFLAGS`  to buildflags.conf.



`-ggdb3`: 指定生成调试信息的级别为GDB调试器的级别3。

`-O0`: 禁用优化。编译器将不会进行任何优化，这有助于在调试过程中更容易理解源代码。

`-fdebug-prefix-map=/home/siyu/xserver-xorg=.`: 指定调试信息中源代码路径的映射关系。将/home/siyu/xserver-xorg的路径映射为.，即当前目录。

`-fstack-protector-strong`: 启用堆栈保护。编译器将插入额外的代码来保护函数的局部变量和返回地址，以防止缓冲区溢出攻击。

`-Wformat`: 启用格式化字符串检查警告。编译器将检查printf和scanf等函数的格式字符串是否与参数匹配。

`-Werror=format-security`: 将格式化字符串检查警告视为错误。如果编译过程中出现格式化字符串不匹配的警告，将导致编译失败。

# dpkg-buildpackage命令详解：

| 选项                  | 描述                                             |
| --------------------- | ------------------------------------------------ |
| -uc                   | 跳过对软件包源代码的签名验证。                   |
| -b                    | 仅构建二进制软件包，而不构建源代码软件包。       |
| -j<number>            | 指定并行构建的作业数。                           |
| -S                    | 仅构建源代码软件包，而不构建二进制软件包。       |
| -sa                   | 在生成源代码软件包时，将原始源代码文件包含在内。 |
| -sd                   | 在生成源代码软件包时，不包含原始源代码文件。     |
| -tc=<dir>             | 指定构建过程中的临时目录。                       |
| -rfakeroot            | 在构建过程中使用fakeroot工具模拟root权限。       |
| -A                    | 仅构建所有架构无关的软件包。                     |
| -B                    | 仅构建所有架构相关的软件包。                     |
| -d                    | 忽略构建软件包时的依赖关系。                     |
| -i                    | 忽略构建软件包时的建议关系。                     |
| -I                    | 忽略构建软件包时的建议关系和所有其他关系。       |
| -tc=<dir>             | 使用指定的目录作为临时构建目录。                 |
| -S -si -sa            | 生成并签名源代码软件包，包括原始源代码文件。     |
| --no-pre-clean        | 在构建之前不执行预清理操作。                     |
| --no-preparation      | 跳过构建准备阶段。                               |
| --no-act              | 仅显示将执行的操作，而不实际执行。               |
| --build=any           | 构建所有支持的架构。                             |
| --preserve-env        | 保留当前环境变量，不重置为默认值。               |
| --exclude=<pkg>       | 在构建过程中排除指定的软件包。                   |
| --force-sign          | 强制对软件包进行签名。                           |
| --no-sign             | 不对软件包进行签名。                             |
| --unsigned-changes    | 允许使用未签名的.changes文件。                   |
| --source-option=<opt> | 传递额外的选项给dpkg-source命令。                |